From 0be86e1926939a98afbd2f3a23c673dfc4df2a7c Mon Sep 17 00:00:00 2001
From: Mike Frysinger <vapier@gentoo.org>
Date: Wed, 31 Jan 2018 14:50:16 -0500
Subject: [PATCH] gd/gd2: make sure transparent palette index is within bounds
 #383

The gd image formats allow for a palette of 256 colors,
so if the transparent index is out of range, disable it.
diff --git a/src/gd_gd.c b/src/gd_gd.c
index ae3da7b..90ce018 100755
--- a/src/gd_gd.c
+++ b/src/gd_gd.c
@@ -94,7 +94,8 @@ _gdGetColors (gdIOCtx * in, gdImagePtr im, int gd2xFlag)
 		if (!gdGetWord (&im->transparent, in)) {
 			goto fail1;
 		}
-		if (im->transparent > im->colorsTotal) {
+		/* Make sure transparent index is within bounds of the palette. */
+		if (im->transparent >= 256 || im->transparent < 0) {
 			im->transparent = (-1);
 		}
 	}
